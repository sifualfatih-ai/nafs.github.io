<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <title>Login — Nafs Premium</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { color-scheme: dark; }
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      min-height:100dvh; display:grid; place-items:center;
      background: linear-gradient(135deg,#2a0f4a,#1a0b2e 45%,#0c0516);
      color:#fff;
    }
    .card{
      width:min(420px,92%);
      background:#130c22; border:1px solid #3b2a55; border-radius:14px;
      padding:22px 18px; box-shadow:0 12px 40px rgba(0,0,0,.35)
    }
    h1{margin:0 0 10px;font-size:18px}
    p{margin:.25rem 0 1rem;color:#b9a9d6;font-size:13px}
    form{display:grid; gap:10px}
    input{
      padding:12px 12px; border-radius:10px; border:1px solid #4b3b6b;
      background:#0e0a18; color:#fff; outline: none;
    }
    button{
      padding:12px; border-radius:10px; border:none; cursor:pointer;
      background:#7c5cff; color:#fff; font-weight:600;
    }
    button[disabled]{opacity:.6; cursor:not-allowed}
    #msg{min-height:1.2em; color:#ffb3b3; font-size:13px}
  </style>
</head>
<body>

  <div class="card">
    <h1>Login diperlukan</h1>
    <p>Masuk untuk mengakses <b>Nafs Premium</b>.</p>

    <form id="f">
      <input id="em" type="email" placeholder="email@gmail.com" required />
      <input id="pw" type="password" placeholder="password" required />
      <button id="btn">Login</button>
      <div id="msg"></div>
    </form>
  </div>

  <script type="module">
    // Halaman tujuan setelah login (default: /nfs/premium/)
    const BACK_URL = sessionStorage.getItem('prev_page') || '/nfs/premium/';

    // ---- Firebase Auth (client config sudah di /firebase.js?v=2) ----
    import { auth } from '/firebase.js?v=2';
    import {
      onAuthStateChanged,
      signInWithEmailAndPassword
    } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';

    const form = document.getElementById('f');
    const em   = document.getElementById('em');
    const pw   = document.getElementById('pw');
    const btn  = document.getElementById('btn');
    const msg  = document.getElementById('msg');

    // Jika sudah login di Firebase → tandai lokal & kembali
    onAuthStateChanged(auth, (user) => {
      if (user) {
        // Tandai akses premium aktif (dipakai oleh /nfs/premium/index.html)
        localStorage.setItem('nafs_isLoggedIn', '1');
        location.replace(BACK_URL);
      }
    });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      msg.textContent = '';
      btn.disabled = true;

      try {
        const email = em.value.trim().toLowerCase();
        const pass  = pw.value;

        await signInWithEmailAndPassword(auth, email, pass);
        // Sukses → akan ditangani oleh onAuthStateChanged di atas
      } catch (err) {
        // Tampilkan pesan singkat yang ramah
        const raw = err?.code || err?.message || 'Login gagal';
        let nice = 'Login gagal. Periksa email & password.';
        if (raw.includes('invalid-credential')) nice = 'Email atau password salah.';
        if (raw.includes('too-many-requests'))  nice = 'Terlalu banyak percobaan. Coba lagi nanti.';
        if (raw.includes('network-request-failed')) nice = 'Koneksi jaringan bermasalah.';

        msg.textContent = nice;
        btn.disabled = false;
      }
    });
  </script>
</body>
</html>
